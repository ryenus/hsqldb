<?xml version="1.0"?>
<!-- $Id -->
<!-- author fredt@users.sourceforge.net 2001 - 2007 -->
<!-- additional targets by unsaved@users.sourceforge.net 2004 - 2007 -->

<project name="hsqldb" default="help" basedir="../">
   <!-- This loads properties in the same exact way as if you ran
        "ant -Dprop1name=val1 -Dprop2name=val2...", etc.  To use all
        defaults, you should have no 'build.properties' file.
        If you don't understand this or want to know about precedence or
        how to use an Ant properties file, look up an Ant manual or an
        Ant expert.
        If you want to know, "Can I set property 'x' in 'build.properties'",
        rephrase the question to yourself as "Can I run 'ant -Dx=...?"
        Do not address questions about property file(s) to the
        hsqldb community. -->
   <property file='build/build.properties'/>
   <property name="hsqldb.version" value="1.8.0"/>

   <tstamp>
       <format property="_tmpstamp" pattern="yyyy/MM/dd-hh:mm:ss"
               locale="en"/>
   </tstamp>

   <property name="build.label" value="private-${_tmpstamp}"/>
   <property name="build.vendor" value="${user.name}"/>
   <property name="hsqldb.title" value="HSQLDB"/>
   <property name="hsqldb.vendor" value="The HSQLDB Development Group"/>
   <property name="swsrc" value="tmp/switchedsrc"/>

   <!-- It is safe to override these with settings in your own 
        build.properties file. -->
   <property name="build.debug" value="on"/>
   <property name="servletapi.lib" value="lib/servlet.jar"/>
   <property name="junit38.lib" value="lib/junit.jar"/>

   <target name="init">
   </target>

   <target name='explainjars'
           description="List description of jars that you can build">
     <echo>jar filename    build command   explanation
--------------  -------------   -----------------------------------
hsqldb.jar      ant hsqldb      Default distribution jar
hsqljdbc.jar    ant hsqljdbc    JDBC client only.  (No direct urls
                                of form jdbc:hsqldb:mem/file/res:*)
hsqldbmain.jar  ant hsqldbmain  No utility programs
hsqldbutil.jar  ant hsqldbutil  Utility programs only.  No JDBC
                                driver.  (Includes SqlTool and
                                DatabaseManagers)
hsqldbmin.jar   ant hsqldbmin   No utility or server programs.
                                (Include JDBC driver, but no support
                                for urls of form jdbc:hsqldb:ht*...)
hsqldbtest.jar  ant hsqldbtest  All, including test classes
hsqldbz.jar     ant hsqldbz     Min jar plus necessary util classes
                                for Zaurus
hsqltool.jar    ant hsqltool    SqlTool client and JDBC driver.
                                (No direct urls of form
                                jdbc:hsqldb:mem/file/res:*)

jars built with JDK 1.2 OR 1.3 can now be used with JRE 1.1.</echo>
   </target>

   <!-- Deprecated targets.  New naming convention is:
        Target name is always the same as the desired jar file name, less
        the ".jar" extension. -->
   <target name='jar' depends='hsqldb'/>
   <target name='jarclient' depends='hsqljdbc'/>
   <target name='jarmain' depends='hsqldbmain'/>
   <target name='jarmin' depends='hsqldbmin'/>
   <target name='jarsqltool' depends='hsqltool'/>
   <target name='jartest' depends='hsqldbtest'/>
   <target name='jarutil' depends='hsqldbutil'/>
   <target name='jarzaurus' depends='hsqldbz'/>

   <target name="help" description="Top-level help message">
      <echo>usage:
   ant -help            Display ant help screen
   ant -projecthelp     Display all invocable targets
   ant explainjars      List all targets which build jar files
   ant ANYTHING ELSE    Run 'ant -projecthelp' for details

   jars built with JDK 1.2 OR 1.3 can now be used with JRE 1.1

examples:
   ant jar
   ant clean</echo>
   </target>

   <target name="-javajsse">
      <available classname="javax.net.ssl.SSLSession" property="ant.java.hasjsse"/>
      <echo message="ant.java.hasjsse=${ant.java.hasjsse}" />
   </target>

   <!-- If there really are no inter-dependencies between these availability
        properties (i.e., we always want to set all of these properties
        during setup), then we should clean things up and make one
        -checkAvailability, or similar, target instead of 4. -->

   <target name="-javaversion6">
      <available classname="java.net.IDN" property="ant.java.iscjava16"/>
      <available classname="java.net.IDN" property="ant.java.iscjava14"/>
      <available classname="java.net.IDN" property="ant.java.iscjavamodern"/>
   </target>

   <target name="-javaversion4" depends="-javaversion6" unless="ant.java.iscjava16">
      <available classname="java.nio.Buffer" property="ant.java.iscjava14"/>
      <available classname="java.nio.Buffer" property="ant.java.iscjavamodern"/>
   </target>

   <!-- I can't think of any reason for the 'unless' att.
        If this is to prevent repeat runs, then why depend on a property
        which may or may not be called by a sub-target.
        This property is not set elsewhere, and doesn't look at all like
        a property which would be set externally (by -D or a properties file).
                                                      - blaine
   -->
   <target name="-javaversion2" depends="-javaversion4"
           unless="ant.java.iscjava14">
      <available classname="java.lang.ref.Reference" property="ant.java.iscjava12"/>
      <available classname="java.lang.ref.Reference" property="ant.java.iscjavamodern"/>
   </target>

   <target name="-prepare" depends="init,-javaversion2">
       <mkdir dir="classes" />
   </target>

   <target name="-preparedoc" depends="init">
       <mkdir dir="doc/src" />
   </target>

   <target name="clean" depends="clean-docwork"
           description="Delete the /classes and work directories created by ant tasks">
        <delete dir="classes"/>
        <delete dir="${swsrc}"/>
   </target>

   <target name="cleanall" depends="clean,clean-doc"
           description="Same as clean but delete the jar files as well">
      <delete>
         <fileset dir="lib" includes="hsql*.jar"/>
      </delete>
   </target>

    <target name="codeswitcher" depends="-prepare"
            description="uses +-JDBC2 +-JDBC2 +-JAVA2">
      <javac destdir="classes">
         <src path="src"/>
         <include name="org/hsqldb/util/CodeSwitcher.java"/>
       </javac>
       <mkdir dir='${swsrc}'/>
       <copy todir='${swsrc}'>
           <fileset dir='src' includes='**/*.java'/>
       </copy>
    </target>

    <target name="switchtojava1target" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
        <arg file="${swsrc}/org/hsqldb/lib/java/JavaSystem.java"/>
        <arg file="${swsrc}/org/hsqldb/util/ConnectionDialogCommon.java"/>
        <arg value="+JAVA1TARGET"/>

      </java>
    </target>

    <target name="switchoffjava1target" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
         <arg file="${swsrc}/org/hsqldb/lib/java/JavaSystem.java"/>
         <arg file="${swsrc}/org/hsqldb/util/ConnectionDialogCommon.java"/>
         <arg value="-JAVA1TARGET"/>
       </java>
    </target>

    <target name="switchtodeprecatedjdbc" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
        <arg value="+DEPRECATEDJDBC"/>
      </java>
    </target>

    <target name="switchoffdeprecatedjdbc" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
        <arg value="-DEPRECATEDJDBC"/>
      </java>
    </target>

    <!-- If this should not be called externally, rename to -switches
         and remove the description attribute -->
    <target name="switches" depends="codeswitcher"
            description="Execute code switchers, other than for JVM version">
    </target>

    <target name="switchtojdk11" depends="switches"
            description="self explanatory" unless="ant.java.iscjavamodern">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
        <arg file="${swsrc}/org/hsqldb/jdbc/pool/BaseConnectionWrapper.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCConnectionPoolDataSource.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCPooledConnection.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/pool/ManagedPoolDataSource.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStubs.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcBlob.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcClob.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcConnection.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDataSource.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSetMetaData.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStatement.java"/>
        <arg file="${swsrc}/org/hsqldb/jdbc/Util.java"/>
        <arg file="${swsrc}/org/hsqldb/lib/SimpleLog.java"/>
        <arg file="${swsrc}/org/hsqldb/rowio/RowInputTextLog.java"/>
        <arg file="${swsrc}/org/hsqldb/HsqlDateTime.java"/>
        <arg value="-JAVA2"/>
        <arg value="-JDBC3"/>
        <arg value="-JDBC4"/>
      </java>
      <available classname="java.util.Vector" property="noswing"/>
    </target>

    <target name="switchtojdk12" depends="switches"
            description="self explanatory" if="ant.java.iscjava12">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/BaseConnectionWrapper.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCConnectionPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCPooledConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/ManagedPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStubs.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcBlob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcClob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSetMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/Util.java"/>
          <arg file="${swsrc}/org/hsqldb/lib/SimpleLog.java"/>
          <arg file="${swsrc}/org/hsqldb/rowio/RowInputTextLog.java"/>
          <arg file="${swsrc}/org/hsqldb/HsqlDateTime.java"/>
          <arg value="+JAVA2"/>
          <arg value="-JDBC3"/>
          <arg value="-JDBC4"/>
      </java>
    </target>

    <target name="switchtojdk14" depends="switches"
            description="self explanatory" if="ant.java.iscjava14" unless="ant.java.iscjava16">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/BaseConnectionWrapper.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCConnectionPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCPooledConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/ManagedPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStubs.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcBlob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcClob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSetMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/Util.java"/>
          <arg file="${swsrc}/org/hsqldb/lib/SimpleLog.java"/>
          <arg file="${swsrc}/org/hsqldb/rowio/RowInputTextLog.java"/>
          <arg file="${swsrc}/org/hsqldb/HsqlDateTime.java"/>
          <arg value="+JAVA2"/>
          <arg value="+JDBC3"/>
          <arg value="-JDBC4"/>
       </java>
    </target>

    <target name="switchtojdk16" depends="switches"
            description="self explanatory" if="ant.java.iscjava16">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath="classes" >
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/BaseConnectionWrapper.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCConnectionPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/JDBCPooledConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/pool/ManagedPoolDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStubs.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcBlob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcCallableStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcClob.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcConnection.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDataSource.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcPreparedStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSet.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcResultSetMetaData.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/jdbcStatement.java"/>
          <arg file="${swsrc}/org/hsqldb/jdbc/Util.java"/>
          <arg file="${swsrc}/org/hsqldb/lib/SimpleLog.java"/>
          <arg file="${swsrc}/org/hsqldb/rowio/RowInputTextLog.java"/>
          <arg file="${swsrc}/org/hsqldb/HsqlDateTime.java"/>
          <arg value="+JAVA2"/>
          <arg value="+JDBC3"/>
          <arg value="+JDBC4"/>
       </java>
    </target>

    <target name="store" depends="switchtojdk11,switchtojdk12,switchtojdk14,switchtojdk16"
            description="compiles the /store folder">
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
      >
         <include name="org/hsqldb/store/**"/>
      </javac>
    </target>

    <target name="lib" depends="store"
            description="compiles the /lib folder">
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
      >
         <include name="org/hsqldb/lib/**"/>
         <include name="org/hsqldb/lib/java/**"/>
      </javac>
    </target>

    <target name="classes" depends="lib,-javajsse"
            description="compiles all the classes">
      <available property='_servlet_available' classpath='${servletapi.lib}'
                 classname='javax.servlet.ServletException'/>
      <fail unless='_servlet_available'
            message="Put '${servletapi.lib}' into place"/>
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
         <classpath>
            <pathelement location="${servletapi.lib}"/>
            <pathelement location="lib/JAMon.jar"/>
         </classpath>
         <include name="*.java"/>
         <include name="org/hsqldb/*.java"/>
         <include name="org/hsqldb/dbinfo/*.java"/>
         <include name="org/hsqldb/index/*.java"/>
         <include name="org/hsqldb/jdbc/*.java"/>
         <include name="org/hsqldb/navigator/*.java"/>
         <include name="org/hsqldb/persist/*.java"/>
         <include name="org/hsqldb/resources/*.java"/>
         <include name="org/hsqldb/result/*.java"/>
         <include name="org/hsqldb/rowio/*.java"/>
         <include name="org/hsqldb/scriptio/*.java"/>
         <include name="org/hsqldb/server/*.java"/>
         <include name="org/hsqldb/store/*.java"/>
         <include name="org/hsqldb/types/*.java"/>
         <exclude name="org/hsqldb/server/HsqlSocketFactorySecure.java" unless="ant.java.hasjsse"/>
         <exclude name="org/hsqldb/jdbc/jdbcBlob.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcClob.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSource*.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcSavepoint.java"/>
<!-- BEGIN JDBC 4-->
         <exclude name="org/hsqldb/jdbc/jdbcNClob.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcRowId.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcSQLXML.java"/>
<!-- TODO
         <exclude name="org/hsqldb/jdbc/jdbcConflictingRowImpl.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSetImpl.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSetResolverImpl.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcQueryObjectGeneratorImpl.java"/>
	 <exclude name="org/hsqldb/jdbc/jdbcRowSet.java"/>
-->
<!-- end JDBC 4 -->
         <exclude name="org/hsqldb/persist/NIOLockFile.java"/>
         <exclude name="org/hsqldb/persist/NIOScaledRAFile.java"/>
      </javac>
      <copy todir="classes/org/hsqldb/resources">
         <fileset dir="src/org/hsqldb/resources" includes="*.properties"/>
      </copy>
    </target>

   <target name="classes12" depends="classes" if="ant.java.iscjavamodern"
           description="compiles 1.2 specific classes">
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
         <include name="org/hsqldb/jdbc/jdbcBlob.java"/>
         <include name="org/hsqldb/jdbc/jdbcClob.java"/>
      </javac>
   </target>

   <target name="classes14" depends="classes12" if="ant.java.iscjava14"
           description="compiles 1.4 specific classes">
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
      <include name="org/hsqldb/jdbc/pool/*.java"/>
      <include name="org/hsqldb/jdbc/jdbcDataSource*.java"/>
      <include name="org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
      <include name="org/hsqldb/jdbc/jdbcSavepoint.java"/>
      <include name="org/hsqldb/persist/NIOLockFile.java"/>
      <include name="org/hsqldb/persist/NIOScaledRAFile.java"/>
      </javac>
   </target>

   <target name="classes16" depends="classes14" if="ant.java.iscjava16"
           description="compiles 1.6 specific classes">
      <javac srcdir="${swsrc}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
         <include name="org/hsqldb/jdbc/jdbcNClob.java"/>
         <include name="org/hsqldb/jdbc/jdbcRowId.java"/>
         <include name="org/hsqldb/jdbc/jdbcSQLXML.java"/>
<!-- TODO
         <include name="org/hsqldb/jdbc/jdbcConflictingRowImpl.java"/>
         <include name="org/hsqldb/jdbc/jdbcDataSetImpl.java"/>
         <include name="org/hsqldb/jdbc/jdbcDataSetResolverImpl.java"/>
         <include name="org/hsqldb/jdbc/jdbcQueryObjectGeneratorImpl.java"/>
	 <include name="org/hsqldb/jdbc/jdbcRowSet.java"/>
-->
      </javac>
      <copy todir="classes/META-INF">
         <fileset dir="src/META-INF"/>
      </copy>
   </target>

   <!-- Don't both to use name beginning with - AND supply a 'description'.
        If this should be externally callable, then remove the leading -
        and change the following description to a description attribute:
                                               - blaine

        compiles 1.4-specific test classes
   -->
    <target name="-test14" if="ant.java.iscjava14" depends='switches'>
      <antcall inheritall='true' target='-requireJunit'/>
      <!-- using antcall instead of depends so that it is not called if the
           target "if" above is false. -->
      <javac srcdir="${swsrc}"
             destdir="classes"
             debug="${build.debug}"
             optimize="${build.optimize}"
             classpath="${junit38.lib}"
       >
          <include name="org/hsqldb/test/TestJDBCSavepoints.java"/>
          <include name="org/hsqldb/test/SqlToolHarness.java"/>
          <include name="org/hsqldb/test/TestSqlTool*.java"/>
      </javac>
   </target>

    <target name="util" depends="lib"
            description="compiles the /util folder">
      <javac srcdir="${swsrc}"
             destdir="classes"
             debug="${build.debug}"
             optimize="${build.optimize}"
      >
         <include name="org/hsqldb/util/**"/>
         <exclude name="org/hsqldb/util/*Swing.java"/>
         <exclude name="org/hsqldb/util/TableSorter.java"/>
      </javac>
      <copy todir="classes/org/hsqldb/util">
          <fileset dir="src/org/hsqldb/util" includes='*.gif, *.png'/>
      </copy>
    </target>

   <target name="swing" depends="util" unless="noswing"
           description="compiles the swing based classes in the /util folder">
      <javac srcdir="${swsrc}"
             destdir="classes"
             debug="${build.debug}"
             optimize="${build.optimize}"
       >
      <include name="org/hsqldb/util/*Swing.java"/>
      <include name="org/hsqldb/util/TableSorter.java"/>
      </javac>
   </target>

   <target name='-requireJunit'>
      <available property='_junit_available' classpath='${junit38.lib}'
                 classname='junit.swingui.TestRunner'/>
      <fail unless='_junit_available'
            message="Put '${junit38.lib}' into place"/>
   </target>

   <target name="test" depends="-requireJunit, classes16"
           description="compiles the /test folder">
      <javac srcdir="${swsrc}"
             destdir="classes"
             debug="${build.debug}"
             optimize="${build.optimize}"
         >
         <classpath>
            <pathelement location="${junit38.lib}"/>
            <pathelement location="lib/dbunit.jar"/>
         </classpath>
         <include name="org/hsqldb/test/**"/>
         <exclude name="org/hsqldb/test/TestJDBCSavepoints.java"/>
         <exclude name="org/hsqldb/test/*SqlTool*.java"/>
      </javac>
      <antcall inheritall='true' target='-test14'/>
   </target>

    <target name="hsqldbz" depends="classes16,util"
            description="Build the hsqldbz.jar for Zaurus">
        <fail if="ant.java.iscjava14"
              message="Zarus jar must be built with JDK 1.3 or previous"/>
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldbz.jar"
             basedir="classes"
         >
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='Zaurus runtime'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
         </manifest>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*Transfer*"/>
         <exclude name="org/hsqldb/util/*Swing*"/>
         <exclude name="org/hsqldb/util/DataAccess*"/>
         <exclude name="org/hsqldb/util/*Helper*"/>
         <exclude name="org/hsqldb/util/JDBCTypes.*"/>
         <exclude name="org/hsqldb/util/SQLStatements.*"/>
         <exclude name="org/hsqldb/util/QueryTool.*"/>
         <exclude name="org/hsqldb/util/ShutdownServer.*"/>
         <exclude name="org/hsqldb/util/CodeSwitcher.*"/>
         <exclude name="org/hsqldb/test/*"/>
         <exclude name="org/hsqldb/sample/*"/>
         <exclude name="hsqlServlet.class"/>
         <exclude name="org/hsqldb/server/Servlet.class"/>
         <exclude name="org/hsqldb/server/HsqlServerFactory.class"/>
         <exclude name="org/hsqldb/server/HsqlServerProperties.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketRequestHandler.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketRequestHandlerImpl.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSource.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSourceFactory.class"/>
         <exclude name="org/hsqldb/server/Server.class"/>
         <exclude name="org/hsqldb/server/Server$ServerThread.class"/>
         <exclude name="org/hsqldb/server/ServerConnection.class"/>
         <exclude name="org/hsqldb/server/ServerConfiguration.class"/>
         <exclude name="org/hsqldb/server/WebServer.class"/>
         <exclude name="org/hsqldb/server/WebServerConnection.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
         <exclude name="org/hsqldb/jdbc/pool/*.class"/>
       </jar>
    </target>

    <target name="hsqldbtest" depends="test,swing"
            description="Build the hsqldbtest.jar (default plus test classes)">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldbtest.jar"
             basedir="classes"
         >
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='Test runtime'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
         </manifest>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/sample/*"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

    <!--
            Sat Nov 19 17:52:33 EST 2005  Blaine changing this description,
            because I see no Swing classes in hsqldbmain.jar when I build
            it... why would anybody ever want them in a no-util jar anyways?

            description="Build the hsqldbmain.jar (no utilities) (use ant switch '-Dnoswing=true' to exclude swing classes)">
    -->
    <target name="hsqldbmain" depends="classes16"
            description="Build the hsqldbmain.jar (no utilities)">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldbmain.jar"
             basedir="classes"
         >
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='Runtime without utilities'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
         </manifest>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*"/>
         <exclude name="org/hsqldb/test/*"/>
         <exclude name="org/hsqldb/sample/*"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

    <target name="hsqldbmin" depends="classes16"
            description="Build the hsqldbmin.jar (no connection pooling or servers)">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldbmin.jar"
             basedir="classes"
         >
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                 value='Runtime without utilities, connection pooling and servers'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
         </manifest>
         <!-- Without this, some ANT/Java combinations may get confused and
              include nothing in the jar -->
         <include name="**/*"/>
         <!-- -->
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
         <exclude name="org/hsqldb/jdbc/pool/*"/>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*"/>
         <exclude name="org/hsqldb/test/*"/>
         <exclude name="org/hsqldb/sample/*"/>
         <exclude name="org/hsqldb/resources/*.properties"/>
         <include name="org/hsqldb/resources/sql-error-messages.properties"/>
         <exclude name="hsqlServlet.class"/>
         <exclude name="org/hsqldb/Servlet.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketFactory.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketFactorySecure.class"/>
         <exclude name="org/hsqldb/srever/HsqlServerFactory.class"/>
         <exclude name="org/hsqldb/srever/HsqlServerProperties.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketRequestHandler.class"/>
         <exclude name="org/hsqldb/server/HsqlSocketRequestHandlerImpl.class"/>
         <exclude name="org/hsqldb/server/Server.class"/>
         <exclude name="org/hsqldb/server/Server$ServerThread.class"/>
         <exclude name="org/hsqldb/server/ServerConnection.class"/>
         <exclude name="org/hsqldb/server/ServerConfiguration.class"/>
         <exclude name="org/hsqldb/server/WebServer.class"/>
         <exclude name="org/hsqldb/server/WebServerConnection.class"/>
         <exclude name="org/hsqldb/dbinfo/DatabaseInformationFull.class"/>
         <exclude name="org/hsqldb/rowio/RowInputLegacy.class"/>
         <exclude name="org/hsqldb/rowio/RowOutputLegacy.class"/>
         <exclude name="org/hsqldb/dbinfo/DIProcedureInfo.class"/>
         <exclude name="org/hsqldb/HSQLClientConnection.class"/>
         <exclude name="org/hsqldb/HTTPClientConnection.class"/>
       </jar>
    </target>

    <target name="hsqldb" depends="classes16,util,swing"
            description="Build the default hsqldb.jar">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldb.jar"
             basedir="classes"
             compress="true"
         >
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='Standard runtime'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
             <!-- This attribute is completely ignored unless the user
                  uses the jar like "java -jar .../hsqldb.jar" -->
             <attribute name='Main-Class' value='org.hsqldb.util.SqlTool'/>
         </manifest>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*Swing.*" if="noswing"/>
         <exclude name="org/hsqldb/util/*Transfer*"/>
         <exclude name="org/hsqldb/util/DataAccess*"/>
         <exclude name="org/hsqldb/util/*Helper*"/>
         <exclude name="org/hsqldb/util/JDBCTypes.*"/>
         <exclude name="org/hsqldb/util/SQLStatements.*"/>
         <exclude name="org/hsqldb/util/QueryTool.*"/>
         <exclude name="org/hsqldb/util/Zaurus*"/>
         <exclude name="org/hsqldb/test/*.class"/>
         <exclude name="org/hsqldb/sample/*.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

    <fileset id='jdbcclasses' dir='classes'
        includes='META-INF/services/java.sql.Driver,
                  org/hsqldb/lib/ArrayUtil*,
                  org/hsqldb/lib/AsciiStringInputStream*,
                  org/hsqldb/lib/CountdownInputStream*,
                  org/hsqldb/lib/HsqlByte*,
                  org/hsqldb/lib/IntValueHashMap*,
                  org/hsqldb/lib/InOutUtil*,
                  org/hsqldb/lib/Iterator*,
                  org/hsqldb/lib/HsqlHeap*,
                  org/hsqldb/lib/HsqlArray*,
                  org/hsqldb/lib/ObjectComparator*,
                  org/hsqldb/lib/IntKeyHashMap*,
                  org/hsqldb/lib/Collection*,
                  org/hsqldb/lib/*List*,
                  org/hsqldb/lib/Set*,
                  org/hsqldb/lib/Hash*,
                  org/hsqldb/lib/HsqlTimer*,
                  org/hsqldb/lib/StringConverter*,
                  org/hsqldb/lib/StringInputStream*,
                  org/hsqldb/lib/java/JavaSystem*,
                  org/hsqldb/jdbc/jdbc*,
                  org/hsqldb/jdbc/Util*,
                  org/hsqldb/jdbc/pool/*,
                  org/hsqldb/rowio/RowOutputBase*,
                  org/hsqldb/rowio/RowInputBase*,
                  org/hsqldb/rowio/RowOutputBinary*,
                  org/hsqldb/rowio/RowInputBinary*,
                  org/hsqldb/rowio/RowOutputInterface*,
                  org/hsqldb/rowio/RowInputInterface*,
                  org/hsqldb/persist/HsqlDatabaseProperties*,
                  org/hsqldb/persist/HsqlProperties*,
                  org/hsqldb/store/ValuePool*,
                  org/hsqldb/store/HashIndex*,
                  org/hsqldb/store/BaseHashMap*,
                  org/hsqldb/types/*,
                  org/hsqldb/Column*,
                  org/hsqldb/DatabaseURL*,
                  org/hsqldb/HSQLClient*,
                  org/hsqldb/HsqlDateTime*,
                  org/hsqldb/HsqlException*,
                  org/hsqldb/server/HsqlSocketFactory*,
                  org/hsqldb/HTTPClientConnection*,
                  org/hsqldb/jdbcDriver*,
                  org/hsqldb/Library*,
                  org/hsqldb/Record*,
                  org/hsqldb/Result*,
                  org/hsqldb/Result$*,
                  org/hsqldb/Row*,
                  org/hsqldb/SessionInterface*,
                  org/hsqldb/Trace*,
                  org/hsqldb/Types*,
                  org/hsqldb/resources/BundleHandler*,
                  org/hsqldb/resources/sql-error-messages*
                  '/>

    <fileset id='utilclasses' dir='classes'
        includes='org/hsqldb/util/**,
                  '/>

    <fileset id='sqltoolclasses' dir='classes'
        includes='org/hsqldb/util/SqlTool*,
                  org/hsqldb/util/RCData*,
                  org/hsqldb/util/SqlFile*
                  '/>

<!-- classes referenced by the org.hsqldb.jdbc package classes -->
<!-- or the org.hsqldb.jdbcDriver class are included here with some -->
<!-- ommissions where the calling methods are not actually used -->
    <target name="hsqljdbc" depends="classes16"
             description="Build the hsqljdbc.jar">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqljdbc.jar" compress="true">
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='JDBC client runtime'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
         </manifest>
            <fileset refid='jdbcclasses'/>
        </jar>
    </target>

    <target name="hsqltool" depends="classes16, util"
            description="Build the hsqltool.jar">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqltool.jar">
            <manifest>
                <attribute name='Specification-Title' value='${hsqldb.title}'/>
                <attribute name='Specification-Version' value='${hsqldb.version}'/>
                <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
                <attribute name='Implementation-Title'
                           value='SqlTool runtime, with JDBC driver'/>
                <attribute name='Implementation-Version' value='${build.label}'/>
                <attribute name='Implementation-Vendor' value='${build.vendor}'/>
                <attribute name='Main-Class' value='org.hsqldb.util.SqlTool'/>
            </manifest>
            <!-- including 'org/hsqldb/jdbc*' just to be safe -->
            <fileset refid='jdbcclasses'/>
            <fileset refid='sqltoolclasses'/>
        </jar>
    </target>

    <target name="hsqldbutil" depends="util,swing"
            description="Build the utility hsqldbutil.jar">
        <mkdir dir='lib'/>
        <jar jarfile="lib/hsqldbutil.jar" compress="true">
         <manifest>
             <attribute name='Specification-Title' value='${hsqldb.title}'/>
             <attribute name='Specification-Version' value='${hsqldb.version}'/>
             <attribute name='Specification-Vendor' value='${hsqldb.vendor}'/>
             <attribute name='Implementation-Title'
                        value='Utilities runtime, without JDBC driver'/>
             <attribute name='Implementation-Version' value='${build.label}'/>
             <attribute name='Implementation-Vendor' value='${build.vendor}'/>
             <!-- N.b. Blaine removed the Main-Class because this jar is
                  useless without a JDBC driver in the classpath, and you
                  can't add to classpath if invoked with "-jar" -->
         </manifest>
         <fileset refid='utilclasses'/>
      </jar>
    </target>

    <target name="-doclink-1.6" if="ant.java.iscjava16">
        <!-- CHANGEME:  use official jdk 1.6 and JEE 5 links
                        when glassfish/mustang are finalized -->
	<property name="jse.doc.link"
                  value="http://download.java.net/jdk6/docs/api/"/>
        <property name="jee.doc.link"
                  value="http://java.sun.com/j2ee/1.4/docs/api/"/>
    </target>

    <target name="-doclink-1.4"
            depends="-doclink-1.6"
            if="ant.java.iscjava14"
            unless="ant.java.iscjava16">
	<property name="jse.doc.link"
                  value="http://java.sun.com/j2se/1.4.2/docs/api/"/>
        <property name="jee.doc.link"
                  value="http://java.sun.com/j2ee/1.4/docs/api/"/>
    </target>

    <target name="-doclink-1.2"
            depends="-doclink-1.4"
            if="ant.java.iscjava12"
            unless="ant.java.iscjava14">
    	<property name="jse.doc.link"
                  value="http://java.sun.com/j2se/1.3/docs/api/"/>
        <property name="jee.doc.link"
                  value="http://java.sun.com/j2ee/sdk_1.3/techdocs/api/"/>
    </target>

    <target name="javadoc" depends="-preparedoc,-javaversion2,-doclink-1.2"
            description="Create javadoc for the distribution package">
      <javadoc
           sourcefiles="src/org/hsqldb/jdbc/jdbcDriver.java,
                        src/org/hsqldb/Trigger.java,
                        src/org/hsqldb/server/Server.java,
                        src/org/hsqldb/server/WebServer.java,
                        src/org/hsqldb/sample/TriggerSample.java,
                        src/org/hsqldb/util/RCData.java,
                        src/org/hsqldb/util/SqlTool.java"
           destdir="doc/src"
           classpath="${servletapi.lib};${junit38.lib}"
           author="true"
           version="false"
           use="true"
           public="true"
           stylesheetfile="doc/src/hsqldbstylesheet.css"
           windowtitle="${hsqldb.title} ${hsqldb.version} API"
           doctitle="${hsqldb.title} ${hsqldb.version}"
           bottom="&lt;i&gt;Copyright &#169; 2001 - 2005 HSQL Development Group. All Rights Reserved.&lt;/i&gt;">
           <packageset dir='src'>
               <include name='org/hsqldb/jdbc'/>
           </packageset>
           <link href="${jse.doc.link}"/>
           <link href="${jee.doc.link}"/>
     </javadoc>
   </target>

    <target name="javadocdev" depends="-preparedoc,-javaversion2,-doclink-1.2"
            description="Create javadoc for developers">
      <javadoc packagenames="org.hsqldb.*,org.hsqldb.jdbc.*,org.hsqldb.lib.*,org.hsqldb.util.*"
           sourcepath="src"
           destdir="doc/src"
           classpath="${servletapi.lib};${junit38.lib}"
           author="true"
           version="true"
           use="true"
           package="true"
           stylesheetfile="doc/src/hsqldbstylesheet.css"
           windowtitle="${hsqldb.title} ${hsqldb.version} API"
           doctitle="${hsqldb.title} ${hsqldb.version}"
           bottom="&lt;i&gt;Copyright &#169; 2001 - 2005 HSQL Development Group. All Rights Reserved.&lt;/i&gt;">
           <link href="${jse.doc.link}"/>
           <link href="${jee.doc.link}"/>
     </javadoc>
   </target>

   <!-- ******************************************************************* -->
   <!--  From here down to the matching ******* line, DocBook-related stuff -->

    <!-- Only do vigilant runtime checking for props for externally
         executable targets.  Requirements for internals are just noted -->

    <property name='fop-loglevel' value='error'/>
    <property name='style.html' value='${docbook.xsl.home}/html/docbook.xsl'/>
    <property name='style.chunk' value='${docbook.xsl.home}/html/chunk.xsl'/>
    <property name='style.fo' value='${docbook.xsl.home}/fo/docbook.xsl'/>
    <!-- This is default only for invoking some external docbook targets -->
    <property name='outputType' value='html'/>

    <!-- Note that we do not generate postscript by default -->
    <target name='docbook'
        description='Generate all DocBook docs in HTML and PDF formats'
            depends='docbooks-html, docbooks-chunk, docbooks-pdf'/>

    <target name='docbooks-html' depends='-initContrib'
            description='Generate all DocBook non-chunk HTML output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='html'/>
        </antcall>
    </target>
    <target name='docbooks-chunk' depends='-initContrib'
            description='Generate all DocBook Chunk HTML output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='chunk'/>
        </antcall>
    </target>
    <target name='docbooks-pdf' depends='-initContrib'
            description='Generate all DocBook PDF output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='pdf'/>
        </antcall>
    </target>
    <target name='docbooks-ps' depends='-initContrib'
            description='Generate all DocBook Postscript output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='ps'/>
        </antcall>
    </target>

    <target name='-ddIterate'>
        <!-- Iterate through docsrc dirs, invoking condlGenbok for each -->
        <!-- Internal caller MUST set 'outputType' -->
        <pathconvert property='_docsrcdirs' targetos='unix' pathsep='|'
                     setonempty='false'> <path>
             <dirset dir='docsrc' includes='*'/>
        </path> </pathconvert>
        <!-- If is needed so that ant doesn't fail if there are no
             DocDir documents -->
        <if><isset property='_docsrcdirs'/><then>
            <foreach list='${_docsrcdirs}' param='docdirpath' inheritall='false'
                     target='-condlGenbook' delimiter='|'>
                <param name='outputType' value='${outputType}'/>
            </foreach>
        </then></if>
    </target>

    <target name='-condlGenbook'>
        <!-- Conditionally run target 'html' or 'chunked' or 'pdf' -->
        <!-- Internal caller MUST set 'docdirpath' and 'outputType' -->
        <!-- Invoke genbook target iff corresponding DocBook src file exists -->
        <basename property='book' file='${docdirpath}'/>
        <!-- Note that inheritall is true, so we pass through all vars, incl.
             'book'.  N.b. This target (-condlGenbook) should be called
             with inheritall false!! -->
        <if> <available type='file' file='${docdirpath}/${book}.xml'/> <then>
            <antcall target='${outputType}'/>
        </then> </if>
    </target>

    <target name='-preDocbook'>
        <!-- description='Run before generating docbook for a partic. dir -->
        <!-- Required Props:  book -->
        <mkdir dir='tmp/docwork/${book}/cdata'/>
        <if><not><uptodate targetfile='tmp/docwork/${book}/cdata/.status'>
            <!-- Mappers don't work with multiple patterns.
            Therefore, have to use a timestamp file.  -->
            <srcfiles dir='src/org/hsqldb/sample'
             includes='*.java'/>
            <srcfiles dir='sample'
             includes='*.txt, *.ksh, *.properties, *.rc, *.cfg, *.sql'/>
        </uptodate></not><then>
            <!-- This copies files matching the fileset below to the docwork
                 dir w/ data so that DocBook may entity include them.
                 For the time being, these files must reside in the main
                 directory  for this specific book. -->
            <pathconvert property='_virginfiles1' targetos='unix' pathsep='|'
                         setonempty='false'> <path>
                 <fileset dir='src/org/hsqldb/sample' includes='*.java'/>
            </path> </pathconvert>
            <pathconvert property='_virginfiles2' targetos='unix' pathsep='|'
                         setonempty='false'> <path>
                 <fileset dir='sample'
                 includes='*.txt, *.ksh, *.properties, *.rc, *.cfg, *.sql'/>
            </path> </pathconvert>
            <if><isset property='_virginfiles1'/><then>
              <foreach list='${_virginfiles1}' param='vfile' inheritall='false'
                    target='-sandwich1' delimiter='|'>
                    <param name='book' value='${book}'/>
                </foreach>
            </then></if>
            <if><isset property='_virginfiles2'/><then>
              <foreach list='${_virginfiles2}' param='vfile' inheritall='false'
                    target='-sandwich2' delimiter='|'>
                    <param name='book' value='${book}'/>
                </foreach>
            </then></if>
        </then></if>
        <touch file='tmp/docwork/${book}/cdata/.status'/>
    </target>

    <target name='-postDocbook'>
        <!-- Run after generating docbook for a partic. dir -->
        <!-- Property 'book' MUST be set before calling this target -->
        <copy todir='doc'>
            <fileset dir='docsrc' excludes='.*, *.css, *.java, *.sql, *.txt'/>
        </copy>
        <copy todir='doc/${book}'>
            <fileset dir='docsrc/${book}'
                     excludes='.*, *.css, *.java, *.sql, *.txt'/>
        </copy>
        <delete file='doc/${book}/${book}.bs'/>
    </target>

    <target name='chunk' description='Build one Chunk HTML DocBook book'
            depends='-setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'chunk'"/>
        <dependset>
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
              <!-- This messy because ant doesn't support wildcard
              ch[0-9]*.html -->
            <targetfileset  dir='doc/${book}'
                includes='ch0*.html, ch1*.html, ch2*.html, ch3*.html,
                         ch4*.html, ch5*.htlm, ch6*.html, ch7*.html,
                         ch8*.html, ch9*.html, index.html'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/index.html'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <fail unless='style.chunk'
                  message="You must set property 'style.chunk'"/>
            <antcall target='-htmlXslt' inheritall='false'>
                <param name='_stylesheet' value='${style.chunk}'/>
                <param name='book' value='${book}'/>
                <param name='_ext' value='.bs'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
        <copy todir='doc'>
            <fileset dir='docsrc'
                     includes='**/*.css, **/*.java, **/*.sql, **/*.txt'/>
        </copy>
    </target>
    <target name='html' description='Build one single-page HTML DocBook book'
            depends='-setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'html'"/>
        <dependset>
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <targetfileset  dir='doc/${book}' includes='${book}.html'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.html'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <antcall target='-htmlXslt' inheritall='false'>
                <param name='_stylesheet' value='${style.html}'/>
                <param name='book' value='${book}'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
        <copy todir='doc'>
            <fileset dir='docsrc'
includes='**/*.css, **/*.java, **/*.sql, **/*.txt, **/*.properties, **/*.cfg'/>
        </copy>
    </target>
    <target name='fo' description='Build one DocBook FO file'
            depends='-initContrib, -setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'fo'"/>
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
              <!-- This messy because ant doesn't support wildcard
              ch[0-9]*.html -->
              <targetfilelist  dir='tmp/docwork/${book}' files='${book}.fo'/>
        </dependset>
        <if><not><available type='file'
                    file='tmp/docwork/${book}/${book}.fo'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <fail unless='style.html'
                  message="You must set property 'style.html'"/>
            <antcall target='-foXslt' inheritall='false'>
                <param name='book' value='${book}'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
    </target>
    <target name='pdf' depends='fo'>
        <!-- The depended-upon fo target will check required props -->
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <srcfilelist dir='tmp/docwork/${book}' files='${book}.fo'/>
            <targetfilelist dir='doc/${book}' files='${book}.pdf'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.pdf'/></not>
        <then>
            <antcall target='-fop' inheritall='false'>
                <param name='_lvl' value='${fop-loglevel}'/>
                <param name='_fmt' value='application/pdf'/>
                <param name='book' value='${book}'/>
            </antcall>
        </then></if>
    </target>
    <target name='ps' depends='fo'>
        <!-- The depended-upon fo target will check required props -->
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <srcfilelist dir='tmp/docwork/${book}' files='${book}.fo'/>
            <targetfilelist dir='doc/${book}' files='${book}.ps'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.ps'/></not>
        <then>
            <antcall target='-fop' inheritall='false'>
                <param name='_lvl' value='${fop-loglevel}'/>
                <param name='_fmt' value='application/postscript'/>
                <param name='book' value='${book}'/>
            </antcall>
        </then></if>
    </target>

    <target name='-checkXslt' unless='_xsltChecked'>
        <!-- Don't call this before -initContrib called -->
        <if><not> <available
            classname='org.apache.xalan.processor.TransformerFactoryImpl'/>
        </not><then>
        <fail message="XSLT library not available.  See 'readmedocbook.txt'"/>
        </then></if>
        <property name='_xsltChecked' value='true'/>
    </target>

    <target name='-setXsltFilesets'>
        <!-- You MUST set property 'book' before calling this target -->
        <fileset id='bookXsltSrcFiles' dir='docsrc/${book}'
            includes='**/*.xml, **/*.png, **/*.jpg, **/*.txt, **/*.java,
                      **/*.sql, **/*.properties, **/*.rc, **/*.cfg'/>
        <fileset id='sharedXsltSrcFiles' dir='docsrc'
                includes='*.xml, *.txt, *.png, *.java, *.jpg, *.html, *.sql'/>
    </target>

    <target name='-sandwich1'>
        <basename property='base' file='${vfile}'/>
        <loadfile srcfile='${vfile}' property='content'/>
        <dependset>
            <srcfilelist dir='src/org/hsqldb/sample' files='${base}'/>
            <targetfilelist dir='tmp/docwork/${book}/cdata' files='${base}'/>
        </dependset>
        <if><not><available file='tmp/docwork/${book}/cdata/${base}'/></not>
        <then>
            <mkdir dir='tmp/docwork/${book}/cdata'/>
            <echo file='tmp/docwork/${book}/cdata/${base}'
                  message='&lt;![CDATA[${content}]]&gt;'/>
        </then></if>
    </target>

    <target name='-sandwich2'>
        <basename property='base' file='${vfile}'/>
        <loadfile srcfile='${vfile}' property='content'/>
        <dependset>
            <srcfilelist dir='sample' files='${base}'/>
            <targetfilelist dir='tmp/docwork/${book}/cdata' files='${base}'/>
        </dependset>
        <if><not><available file='tmp/docwork/${book}/cdata/${base}'/></not>
        <then>
            <mkdir dir='tmp/docwork/${book}/cdata'/>
            <echo file='tmp/docwork/${book}/cdata/${base}'
                  message='&lt;![CDATA[${content}]]&gt;'/>
        </then></if>
    </target>

    <!-- I'm not sure that <fop> actually needs the Xslt libs, but it
         probably does.  Test this sometime.  -->
    <target name='-initFop' unless='_fop_initted' depends='-checkXslt'>
        <fail unless='fop.home'
  message="To build from DocBook FO files, you must set property 'fop.home'"/>
        <if><not><available file='${fop.home}' type='dir'/></not><then>
            <fail message="The &lt;fop&gt; target not found where expected under '${fop.home}'"/>
        </then></if>
        <taskdef name="fop" classname="org.apache.fop.tools.anttasks.Fop">
            <classpath>
                <fileset dir='${fop.home}/build' includes='fop*.jar'/>
                <!-- See the FOP docs for why these are needed, and where
                     to get them from -->
                <fileset dir='${fop.home}/lib'
                         includes='avalon*.jar, batik*.jar, jimi*.jar'/>
            </classpath>
        </taskdef>
        <property name='_fop_initted' value='true'/>
    </target>

    <target name='-initContrib' unless='_contrib_initted'>
        <!-- We use ant-contrib-X.jar (where X is a version).  Make sure
             that this jar is located at path-to-ant-bin/../lib -->
        <available property='_contrib_there'
                   classname='net.sf.antcontrib.logic.For'/>
        <fail unless='_contrib_there' message="You must put a recent cut of ant-contrib-X.jar into 'path-to-ant-bin/../lib/'"/>
        <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
        <property name='_contrib_initted' value='true'/>
    </target>

    <target name='-fop' depends='-initFop'>
        <!-- Required properties:  book, _lvl, _fmt -->
        <fop format="${_fmt}" outdir="doc/${book}" messagelevel="${_lvl}"
            basedir='docsrc/${book}'>
            <fileset file='tmp/docwork/${book}/${book}.fo'/>
        </fop>
    </target>

    <target name='-htmlXslt' depends='-checkXslt'>
        <!-- This does not check dependencies.  Do that before calling. -->
        <!-- Required properties:  _stylesheet, book -->
        <fail if='_css' message="Internal property '_css' set externally"/>
        <fail unless='docbook.xsl.home' message="To use the DocBook targets, you must set property 'docbook.xsl.home"/>
        <if><not><available type='file' file='${_stylesheet}'/></not><then>
            <fail message="DocBook style sheet '${_stylesheet}' not found."/>
        </then></if>
        <available property='_css' value='${book}.css' type='file'
                   file='docsrc/${book}/${book}.css'/>
        <property name='_css' value='../shared.css'/>
        <property name='_ext' value='.html'/>
        <style
               basedir='docsrc/${book}'
               destdir='doc/${book}'
               force='yes'
               style='${_stylesheet}'
               includes='${book}.xml'
               extension='${_ext}'>
            <param name='html.stylesheet' expression='${_css}'/>
            <param name='navig.graphics' expression='true'/>
            <param name='navig.graphics.path' expression='navicons/'/>
            <param name='navig.graphics.extension' expression='.gif'/>
            <param name='chunk.section.depth' expression='0'/>
        </style>
    </target>

    <target name='-foXslt' depends='-checkXslt'>
        <!-- This does not check dependencies.  Do that before calling. -->
        <!-- Required props:  book -->
        <fail unless='docbook.xsl.home' message="To use the DocBook targets, you must set property 'docbook.xsl.home"/>
        <if><not><available type='file' file='${style.fo}'/></not><then>
            <fail message="DocBook style sheet '${style.fo}' not found."/>
        </then></if>
        <style
               basedir='docsrc/${book}'
               destdir='tmp/docwork/${book}'
               force='yes'
               style='${style.fo}'
               includes='${book}.xml'
               extension='.fo'
         >
            <param name='use.extensions' expression='1'/>
            <param name='tablecolumns.extension' expression='0'/>
            <param name='textinsert.extension' expression='1'/>
            <param name='fop.extensions' expression='1'/>
         </style>
    </target>

    <target name='clean-doc' description='Remove derived documentation files'
            depends='clean-docwork'>
        <!-- All CVS-controlled are in docsrc directory.
             At that point, doc will contain only derived files, and this
             target can just wipe out the docwork and doc directories. -->
        <delete quiet='true' includeEmptyDirs='true'>
            <fileset dir='doc' includes='*.gif, *.css, guide/**'/>
            <fileset dir='doc/src' excludes='*.gif, *.css'/>
        </delete>
        <delete dir='tmp/docwork' quiet='true' includeEmptyDirs='true'/>
    </target>

    <target name='clean-docwork' description='Remove temporary documentation files'>
        <delete dir='tmp/docwork' quiet='true' includeEmptyDirs='true'/>
        <delete quiet='true' includeEmptyDirs='true'>
            <fileset dir='doc' includes='**/*.xml'/>
        </delete>
    </target>
</project>
