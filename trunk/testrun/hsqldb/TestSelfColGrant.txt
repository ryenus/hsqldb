-- $Id$
-- Tests column-specific grants

-- These two users are for sanity tests
/*u0*/CREATE USER privd PASSWORD "privd";
/*u0*/CREATE USER unprivd PASSWORD "unprivd";

/*u0*/CREATE USER u1 PASSWORD "u1";
/*u0*/CREATE TABLE multicol (openc int, closedc int, limitedc int);
/*u0*/GRANT ALL ON multicol TO privd;
/*u1*/INSERT INTO multicol values (1, 2, 3);
/*c1*/select * from multicol;
/*u0*/GRANT SELECT(openc) ON multicol TO u1;


-- Test col-specific SELECTs
/*u0*/CONNECT USER u1 PASSWORD "u1";
/*c1*/select openc from multicol;
/*e*/select closedc from multicol;
/*e*/UPDATE multicol set openc = 4 where closedc = 2;

/*u0*/CONNECT USER privd PASSWORD "privd";
/*c1*/select openc from multicol;
/*c1*/select closedc from multicol;
/*u1*/UPDATE multicol set openc = 5 where closedc = 2;
/*u0*/CONNECT USER unprivd PASSWORD "unprivd";
/*e*/select openc from multicol;
/*e*/select closedc from multicol;
/*e*/UPDATE multicol set openc = 6 where closedc = 2;

-- Test col-specific UPDATEs
/*u0*/CONNECT USER u1 PASSWORD "u1";
/*e*/UPDATE multicol set openc = 7 where closedc = 2;
/*u0*/CONNECT USER SA PASSWORD "";
/*u0*/GRANT update(openc) ON multicol TO u1;
/*u0*/CONNECT USER u1 PASSWORD "u1";
/*u1*/UPDATE multicol set openc = 7 where closedc = 2;

-- Test col-specific INSERTs
/*u0*/CONNECT USER u1 PASSWORD "u1";
/*e*/INSERT INTO multicol(openc) values(10);
/*u0*/CONNECT USER SA PASSWORD "";
/*u0*/GRANT insert(openc) ON multicol TO u1;
/*u0*/CONNECT USER privd PASSWORD "privd";
/*u1*/INSERT INTO multicol(openc) values(11);
/*u0*/CONNECT USER unprivd PASSWORD "unprivd";
/*e*/INSERT INTO multicol(openc) values(12);
/*u0*/CONNECT USER u1 PASSWORD "u1";
/*u1*/INSERT INTO multicol(openc) values(13);

/*u0*/CONNECT USER SA PASSWORD "";
/*u0*/DROP USER u1;
/*u0*/DROP USER privd;
/*u0*/DROP USER unprivd;
/*u0*/SHUTDOWN;
